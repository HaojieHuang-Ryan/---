# 华为心声社区24小时热门评论 - 油猴脚本

## 🧩 脚本简介

本脚本适用于 **华为心声社区**的 [https://xinsheng.huawei.com/next/plus/](https://xinsheng.huawei.com/next/plus/) 页面，自动加载全部评论内容并进行提取、排序、美化展示。  
它解决了页面默认仅加载部分评论、阅读不便的问题，适合想快速了解“24小时最热评论”的用户使用。

---

## 🚀 功能概述

- 🔄 **自动滚动加载全部评论**  
  模拟用户不断滚动，直到页面高度稳定，确保所有内容都被加载。

- 📊 **提取与聚合评论数据**  
  根据帖子标题分组，提取每条评论内容及点赞数，并统计每个分组的总点赞数。

- 🌟 **美化展示评论内容**  
  所有评论以卡片样式渲染，视觉清晰，支持点赞排序或按标题排序。

- 📌 **目录导航**  
  页面右侧自动生成标题目录，支持点击跳转至对应评论区域。

- 📖 **阅读追踪与已读标记**  
  阅读评论 60% 区域后，自动标记为已读，目录颜色变灰并本地保存状态。

- 🧠 **本地存储支持**  
  已读记录使用 `localStorage` 持久保存，页面刷新后依旧保留状态。

- 🎨 **加载动画与遮罩提示**  
  评论加载中显示友好提示和旋转动画，提升用户体验。

---

## 📦 使用方式

1. 安装浏览器插件 [Tampermonkey（油猴）](https://www.tampermonkey.net/)。
2. 创建新脚本并将本代码粘贴进去保存。
3. 打开 [https://xinsheng.huawei.com/next/plus/](https://xinsheng.huawei.com/next/plus/)，脚本自动执行。

---

## 🛠 技术亮点

| 技术特性        | 描述                                                                 |
|----------------|----------------------------------------------------------------------|
| 自动滚动检测    | 使用 `document.body.scrollHeight` 判断页面是否稳定，模拟滚动到底部   |
| 评论聚合逻辑    | 使用 DOM 查询将评论分组聚合，并计算每组总点赞                         |
| UI 渲染优化     | 使用原生 JS 构造 DOM 元素，美化页面展示，清爽扁平风格                 |
| 阅读追踪机制    | 使用滚动监听判断元素是否进入视口，并保存“已读”状态                     |
| 本地存储        | 使用 `localStorage.readTitles` 记录已读条目                           |
| 零依赖设计      | 无需额外库，无 GM 权限，完全在前端页面内运行                          |

---

## 🧩 文件结构简要说明

| 功能模块       | 对应变量 / 函数             |
|----------------|------------------------------|
| 自动加载逻辑   | `scrollAndCheckStable()`     |
| 评论数据提取   | `getContent()`               |
| 排序与渲染     | `renderResults()`            |
| 阅读记录管理   | `getReadTitles()` / `addReadTitle()` |
| 排序切换逻辑   | `currentSort`, `sortBtn.onclick` |
| TOC 导航系统   | 动态生成 `toc` + 滚动监听     |

---

## 💻 页面功能 UI 说明

| 功能项         | 展示位置         |
|----------------|------------------|
| 返回顶部按钮   | 页面右下角固定按钮 |
| 排序切换按钮   | 页面右上角固定按钮 |
| 目录导航（TOC）| 页面右侧浮动面板 |
| 评论内容区域   | 页面中央主体区域 |

---

## 📌 注意事项

- 本脚本依赖页面结构特定的 class 名（如 `.ecard`, `.sat-content`, `.like-txt`），页面结构变动可能导致失效；
- 脚本不会主动发起请求，也不会更改网页数据，仅用于“阅读辅助”和视觉展示增强；
- 阅读记录保存在浏览器 `localStorage` 中，清除浏览器数据将清空记录。

---
